# Config example

# DOI prefixes
zenodo_doi_prefix = 10.5281
cds_videos_doi_prefix = 10.17181
cod_doi_prefix = 10.7483

# URLs
cern_grafana_url = http://monit-metrics-dev:10012/
# cern_grafana_url = http://monit-metrics.cern.ch:10012


# Configure general Celery settings
[celery]
broker_url = redis://localhost:6379/0
result_backend = redis://localhost:6379/1
serializer = metricjson

    # Configure Celery schedules
    [[schedules]]
        [[[doi]]]
        hour = 16
        minute = 15

        [[[repo]]]
        hour = 16
        minute = 15

    # Configure Celery metrics
    [[metrics]]
        # DOI metrics
        [[[zenodo_doi]]]
        instance = kpiit.metrics.doi
        prefix = $zenodo_doi_prefix

        [[[cds_videos_doi]]]
        instance = kpiit.metrics.doi
        prefix = $cds_videos_doi_prefix

        [[[cod_doi]]]
        instance = kpiit.metrics.doi
        prefix = $cod_doi_prefix

    # Configure Celery publishers
    [[publishers]]
        # DOI publishers
        [[[zenodo_doi]]]
        instance = kpiit.publishers.doi
        prefix = $zenodo_doi_prefix

        [[[cds_videos_doi]]]
        instance = kpiit.publishers.doi
        prefix = $cds_videos_doi_prefix

        [[[cod_doi]]]
        instance = kpiit.publishers.doi
        prefix = $cod_doi_prefix

    # Configure Celery tasks
    [[tasks]]
        # Task to collect KPIs for Zenodo DOI resolutions
        [[[zenodo_doi]]]
        task = kpiit.tasks.collect_and_publish_metrics
        schedule = doi
        metrics = zenodo_doi
        publishers = zenodo_doi

        # Task to collect KPIs for CDS videos DOI resolutions
        [[[cds_videos_doi]]]
        task = kpiit.tasks.collect_and_publish_metrics
        schedule = doi
        metrics = cds_videos_doi
        publishers = cds_videos_doi

        # Task to collect KPIs for CERN OpenData DOI resolutions
        [[[cod_doi]]]
        task = kpiit.tasks.collect_and_publish_metrics
        schedule = doi
        metrics = cod_doi
        publishers = cod_doi

[providers]
    # DataCite provider settings
    [[data_cite]]
    index_url = https://stats.datacite.org/stats/resolution-report/index.html
    stats_url = https://stats.datacite.org/stats/resolution-report/

    # Piwik provider settings
    [[piwik]]
    principal = n.persson@CERN.ch
    keytab_file = n.persson.keytab
    base_url = https://piwikui.web.cern.ch/piwikui
    url = $base_url/index.php?module=API&{query}

    # Service Now provider settings
    [[snow]]
    url = https://cerntraining.service-now.com
    incident_table = incident
    request_table = u_request_fulfillment

    # all states that are counted as a "closed" ticket (see Task States below)
    closed_task_states = closed_complete, closed_incomplete, resolved, closed_skipped, closed_abandoned

        # Functional Elements
        [[[fe]]]
        cds = CERN Document Server
        cds_videos = MultiMedia Archive
        cod = Open Data Repository
        zenodo = Zenodo Repository

        # Task States (from https://cerntraining.service-now.com)
        [[[states]]]
        pending = -5
        open = 1
        wip = 2
        closed_complete = 3
        closed_incomplete = 4
        approved = 5
        resolved = 6
        closed_skipped = 7
        closed_abandoned = 8
        ready = 10
        on_hold = 11
        approved2 = 13  # Approved repeated
        awaiting_qualitification = 15
        assigned = 16
        accepted = 17
        wip2 = 18  # WIP repeated
        waiting_3rd_party = 21
        planned = 30
        control = 100
        action = 105
        decision = 110
        compliant = 650
        partially_compliant = 655
        non_compliant = 660

# Configure the deployment script
[deploy]
default_image = kpiit-image:latest
default_registry = openshift-registry.web.cern.ch/it-cda-dr-kpis
default_deployment = deployment.apps/worker

docker_login_cmd = docker login -u openshift -p $(oc whoami -t) {registry}
docker_build_cmd = docker build --no-cache=true --network=host -t {image} .
docker_tag_cmd = docker tag {image} {registry}/{image_name}
docker_push_cmd = docker push {registry}/{image}
redeploy_cmd = oc get --export {} -o json
update_deploy_cmd = oc patch {deployment} -p '{json_data}'